let animationData = { "v": "5.9.0", "fr": 29.9700012207031, "ip": 0, "op": 40.0000016292334, "w": 100, "h": 200, "nm": "White Solid 2", "ddd": 0, "assets": [], "layers": [{ "ddd": 0, "ind": 1, "ty": 4, "nm": "Shape Layer 2", "sr": 1, "ks": { "o": { "a": 0, "k": 100, "ix": 11 }, "r": { "a": 0, "k": 0, "ix": 10 }, "p": { "a": 0, "k": [55.452, 11.125, 0], "ix": 2, "l": 2 }, "a": { "a": 0, "k": [0, 0, 0], "ix": 1, "l": 2 }, "s": { "a": 0, "k": [100, 100, 100], "ix": 6, "l": 2 } }, "ao": 0, "shapes": [{ "ty": "gr", "it": [{ "ty": "sr", "sy": 2, "d": 1, "pt": { "a": 1, "k": [{ "i": { "x": [0.651], "y": [0.91] }, "o": { "x": [0.167], "y": [0.192] }, "t": 0, "s": [3] }, { "i": { "x": [0.674], "y": [1] }, "o": { "x": [0.341], "y": [0.004] }, "t": 23, "s": [3] }, { "i": { "x": [0.833], "y": [1] }, "o": { "x": [0.333], "y": [0] }, "t": 24, "s": [4] }, { "t": 39.0000015885026, "s": [4] }], "ix": 3 }, "p": { "a": 0, "k": [0, 0], "ix": 4 }, "r": { "a": 0, "k": 32400, "ix": 5 }, "or": { "a": 0, "k": 56.859, "ix": 7 }, "os": { "a": 0, "k": 0, "ix": 9 }, "ix": 1, "nm": "Polystar Path 1", "mn": "ADBE Vector Shape - Star", "hd": false }, { "ty": "fl", "c": { "a": 0, "k": [0.949019607843, 0.960784313725, 0.96862745098, 1], "ix": 4 }, "o": { "a": 0, "k": 100, "ix": 5 }, "r": 1, "bm": 0, "nm": "Fill 1", "mn": "ADBE Vector Graphic - Fill", "hd": false }, { "ty": "tr", "p": { "a": 1, "k": [{ "i": { "x": 0.667, "y": 1 }, "o": { "x": 0.167, "y": 0.167 }, "t": 0, "s": [-7.75, 137.75], "to": [0, 0], "ti": [0, 0] }, { "i": { "x": 0.667, "y": 1 }, "o": { "x": 0.333, "y": 0 }, "t": 5, "s": [-7.25, 147.75], "to": [0, 0], "ti": [0, 0] }, { "i": { "x": 0.667, "y": 1 }, "o": { "x": 0.333, "y": 0 }, "t": 20, "s": [-6.25, 28.25], "to": [0, 0], "ti": [0, 0] }, { "i": { "x": 0.667, "y": 1 }, "o": { "x": 0.333, "y": 0 }, "t": 35, "s": [-2.25, 146.25], "to": [0, 0], "ti": [0, 0] }, { "t": 39.0000015885026, "s": [-6.25, 137.75] }], "ix": 2 }, "a": { "a": 0, "k": [0, 0], "ix": 1 }, "s": { "a": 1, "k": [{ "i": { "x": [0.833, 0.833], "y": [0.833, 0.833] }, "o": { "x": [0.167, 0.167], "y": [0.167, 0.167] }, "t": 0, "s": [58.708, 58.708] }, { "t": 39.0000015885026, "s": [50.591, 50.591] }], "ix": 3 }, "r": { "a": 1, "k": [{ "i": { "x": [0.667], "y": [1] }, "o": { "x": [0.167], "y": [0.167] }, "t": 0, "s": [90] }, { "i": { "x": [0.667], "y": [1] }, "o": { "x": [0.333], "y": [0] }, "t": 5, "s": [105.626] }, { "i": { "x": [0.667], "y": [1] }, "o": { "x": [0.333], "y": [0] }, "t": 35, "s": [-335.67] }, { "t": 39.0000015885026, "s": [-315] }], "ix": 6 }, "o": { "a": 0, "k": 100, "ix": 7 }, "sk": { "a": 0, "k": 0, "ix": 4 }, "sa": { "a": 0, "k": 0, "ix": 5 }, "nm": "Transform" }], "nm": "Polystar 1", "np": 3, "cix": 2, "bm": 0, "ix": 1, "mn": "ADBE Vector Group", "hd": false }, { "ty": "rd", "nm": "Round Corners 1", "r": { "a": 0, "k": 10, "ix": 1 }, "ix": 2, "mn": "ADBE Vector Filter - RC", "hd": false }], "ip": 0, "op": 40.0000016292334, "st": 0, "bm": 0 }, { "ddd": 0, "ind": 2, "ty": 4, "nm": "Shape Layer 3", "sr": 1, "ks": { "o": { "a": 0, "k": 100, "ix": 11 }, "r": { "a": 0, "k": 0, "ix": 10 }, "p": { "a": 0, "k": [49.548, 100.625, 0], "ix": 2, "l": 2 }, "a": { "a": 0, "k": [-3.5, 89.75, 0], "ix": 1, "l": 2 }, "s": { "a": 0, "k": [100, 100, 100], "ix": 6, "l": 2 } }, "ao": 0, "hasMask": true, "masksProperties": [{ "inv": false, "mode": "a", "pt": { "a": 1, "k": [{ "i": { "x": 0.833, "y": 0.833 }, "o": { "x": 0.167, "y": 0.167 }, "t": 26, "s": [{ "i": [[27.269, 0], [0, -2.694], [-27.269, 0], [0, 2.694]], "o": [[-27.269, 0], [0, 2.694], [27.269, 0], [0, -2.694]], "v": [[-1.923, 79.125], [-51.298, 84.003], [-3.072, 79.875], [47.452, 84.003]], "c": true }] }, { "t": 32.0000013033867, "s": [{ "i": [[35.684, -0.008], [-0.008, -36.232], [-35.684, 0.008], [0.008, 36.232]], "o": [[-35.684, 0.008], [0.008, 36.232], [35.684, -0.008], [-0.008, -36.232]], "v": [[-2.812, 71.396], [-67.409, 137.014], [-2.783, 202.604], [61.814, 136.986]], "c": true }] }], "ix": 1 }, "o": { "a": 0, "k": 100, "ix": 3 }, "x": { "a": 0, "k": 0, "ix": 4 }, "nm": "Mask 1" }], "shapes": [{ "ty": "gr", "it": [{ "d": 1, "ty": "el", "s": { "a": 0, "k": [50, 50], "ix": 2 }, "p": { "a": 0, "k": [0, 0], "ix": 3 }, "nm": "Ellipse Path 1", "mn": "ADBE Vector Shape - Ellipse", "hd": false }, { "ty": "gf", "o": { "a": 0, "k": 100, "ix": 10 }, "r": 1, "bm": 0, "g": { "p": 3, "k": { "a": 0, "k": [0.675, 0.541, 0.137, 0.137, 0.833, 0.745, 0.21, 0.133, 0.99, 0.949, 0.284, 0.129], "ix": 9 } }, "s": { "a": 0, "k": [10.066, -90.17], "ix": 5 }, "e": { "a": 0, "k": [9.807, 10.548], "ix": 6 }, "t": 1, "nm": "Gradient Fill 1", "mn": "ADBE Vector Graphic - G-Fill", "hd": false }, { "ty": "tr", "p": { "a": 0, "k": [-3.5, 138], "ix": 2 }, "a": { "a": 0, "k": [0, 0], "ix": 1 }, "s": { "a": 0, "k": [197.964, 194.995], "ix": 3 }, "r": { "a": 0, "k": 0, "ix": 6 }, "o": { "a": 0, "k": 100, "ix": 7 }, "sk": { "a": 0, "k": 0, "ix": 4 }, "sa": { "a": 0, "k": 0, "ix": 5 }, "nm": "Transform" }], "nm": "Ellipse 1", "np": 3, "cix": 2, "bm": 0, "ix": 1, "mn": "ADBE Vector Group", "hd": false }], "ip": 0, "op": 40.0000016292334, "st": 0, "bm": 0 }, { "ddd": 0, "ind": 3, "ty": 4, "nm": "Shape Layer 1", "sr": 1, "ks": { "o": { "a": 0, "k": 100, "ix": 11 }, "r": { "a": 0, "k": 0, "ix": 10 }, "p": { "a": 0, "k": [53.048, 10.875, 0], "ix": 2, "l": 2 }, "a": { "a": 0, "k": [0, 0, 0], "ix": 1, "l": 2 }, "s": { "a": 0, "k": [100, 100, 100], "ix": 6, "l": 2 } }, "ao": 0, "shapes": [{ "ty": "gr", "it": [{ "d": 1, "ty": "el", "s": { "a": 0, "k": [50, 50], "ix": 2 }, "p": { "a": 0, "k": [0, 0], "ix": 3 }, "nm": "Ellipse Path 1", "mn": "ADBE Vector Shape - Ellipse", "hd": false }, { "ty": "gf", "o": { "a": 0, "k": 100, "ix": 10 }, "r": 1, "bm": 0, "g": { "p": 3, "k": { "a": 0, "k": [0.013, 0.128, 0.604, 0, 0.587, 0.064, 0.802, 0.2, 0.707, 0, 1, 0.4], "ix": 9 } }, "s": { "a": 0, "k": [0.29, -36.51], "ix": 5 }, "e": { "a": 0, "k": [0.749, 54.218], "ix": 6 }, "t": 2, "h": { "a": 0, "k": 0, "ix": 7 }, "a": { "a": 0, "k": 0, "ix": 8 }, "nm": "Gradient Fill 1", "mn": "ADBE Vector Graphic - G-Fill", "hd": false }, { "ty": "tr", "p": { "a": 0, "k": [-3.5, 138], "ix": 2 }, "a": { "a": 0, "k": [0, 0], "ix": 1 }, "s": { "a": 0, "k": [193, 193], "ix": 3 }, "r": { "a": 0, "k": 0, "ix": 6 }, "o": { "a": 0, "k": 100, "ix": 7 }, "sk": { "a": 0, "k": 0, "ix": 4 }, "sa": { "a": 0, "k": 0, "ix": 5 }, "nm": "Transform" }], "nm": "Ellipse 1", "np": 3, "cix": 2, "bm": 0, "ix": 1, "mn": "ADBE Vector Group", "hd": false }], "ip": 0, "op": 40.0000016292334, "st": 0, "bm": 0 }], "markers": [] };

let button = document.querySelector('.startStop')
let direction = -1;
let start

let params = {
    container: button,
    renderer: 'svg',
    loop: false,
    autoplay: false,
    animationData: animationData,
};

let anim;

anim = lottie.loadAnimation(params);

let times = []

button.addEventListener('click', async () => {
    times.push(new Date().getTime())
    button.classList.toggle('play')
    lottie.play()
    lottie.setDirection(direction *= -1)
    if (times.length === 2) {
        newTime = times[1] - times[0]
        times = []
        var minutes = String(Math.floor(newTime / 60000)).padStart(2, '0');
        var seconds = ((newTime % 60000) / 1000).toFixed(0);
        let millis = String(newTime/1000).split('.')[1] || '000'

        let response = await fetch(storeRoute, {
            method: 'POST',
            headers: {
                'Content-Type': "application/json",
                Accept: "application/json",
            },
            body: JSON.stringify({time: newTime})
        })

        document.querySelector('.newTime .title').innerHTML = minutes + ":" + (seconds < 10 ? '0' : '') + seconds + '.' + (millis || '000')
        if(newTime < currentScore){
            document.querySelector('.newTime').classList.add('isRecord')
        }
        document.querySelector('.newTime').classList.remove('hidden')
        setTimeout(() => {
            if(newTime < currentScore){
                document.querySelector('.record .time').innerHTML = minutes + ":" + (seconds < 10 ? '0' : '') + seconds + '.' + (millis || '000')
            }
            document.querySelector('.newTime').classList.add('hidden')

        }, 3000)

    }
})


function createGrid(size) {
    var grid = new Array(size);
    for (i = 0; i < size; i++) {
        var newRow = new Array(size);
        for (j = 0; j < size; j++) {
            newRow[j] = false;
        }
        grid[i] = newRow;
    }
    return grid;
}

function isSafe(grid, x, y) {
    var length = grid.length;
    for (var row = y - 3; row <= y + 3; row++) {
        if (row >= 0 && row < length) {
            for (var col = x - 3; col <= x + 3; col++) {
                if (col >= 0 && col < length && [row, col] != [y - 3, x - 3] && [row, col] != [y - 3, x + 3] && [row, col] != [y + 3, x - 3] && [row, col] != [y + 3, x + 3]) {
                    if (grid[col][row] == true) {
                        return false;
                    }
                }
            }
        }
    }
    return true;
}

/**
 * Returns a random integer between min (inclusive) and max (inclusive)
 * Using Math.round() will give you a non-uniform distribution!
 */
function getRandomInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

function main() {
    let colors = [
        'hsl(358, 91%, 53%)',
        'hsl(189, 64%, 48%)',
        'hsl(327, 59%, 53%)',
        'hsl(31, 96%, 49%)',
        'hsl(269, 44%, 50%)'
    ]
    var grid = createGrid(1000);
    let dots = '';
    for (i = 0; i < 500; i++) {
        var x = getRandomInt(0, 399);
        var y = getRandomInt(0, 399);
        var color = getRandomInt(0, 4);
        if (isSafe(grid, x, y)) {
            grid[x][y] = true;
            var left = x * 8;
            var top = y * 8;
            var newDot = '<div class="dot" style="left: ' + left + 'px; top: ' + top + 'px;background-color:' + colors[color] + '"></div>'
            dots += newDot
        }
    }
    document.querySelector('#background-container').innerHTML = dots;

}

main()

/**
 * Confetti particle class
 */
class ConfettiParticle {

    constructor(context, width, height) {
        this.context = context;
        this.width = width;
        this.height = height;
        this.color = '';
        this.lightness = 50;
        this.diameter = 0;
        this.tilt = 0;
        this.tiltAngleIncrement = 0;
        this.tiltAngle = 0;
        this.particleSpeed = 1;
        this.waveAngle = 0;
        this.x = 0;
        this.y = 0;
        this.reset();
    }

    reset() {
        this.lightness = 50;
        this.color = Math.floor(Math.random() * 360);
        this.x = Math.random() * this.width;
        this.y = Math.random() * this.height - this.height;
        this.diameter = Math.random() * 6 + 4;
        this.tilt = 0;
        this.tiltAngleIncrement = Math.random() * 0.1 + 0.04;
        this.tiltAngle = 0;
    }

    darken() {
        if (this.y < 100) return;
        this.lightness += (250 / this.height);
    }

    update() {
        this.waveAngle += this.tiltAngleIncrement;
        this.tiltAngle += this.tiltAngleIncrement;
        this.tilt = Math.sin(this.tiltAngle) * 12;
        this.x += Math.sin(this.waveAngle);
        this.y += (Math.cos(this.waveAngle) + this.diameter + this.particleSpeed) * 0.4;
        if (this.complete()) this.reset();
        this.darken();
    }

    complete() {
        return (this.y > this.height + 20);
    }

    draw() {
        let x = this.x + this.tilt;
        this.context.beginPath();
        this.context.lineWidth = this.diameter;
        this.context.strokeStyle = "hsl(" + this.color + ", 80%, " + this.lightness + "%)";
        this.context.moveTo(x + this.diameter / 2, this.y);
        this.context.lineTo(x, this.y + this.tilt + this.diameter / 2);
        this.context.stroke();
    }
}

/**
 * Setup
 */
(function () {
    let card = document.querySelector('.card')
    let width = card.getBoundingClientRect().width;
    let height = card.getBoundingClientRect().height;
    let particles = [];

    // particle canvas
    const canvas = document.querySelector('.canvas');
    const context = canvas.getContext('2d');
    canvas.id = 'particle-canvas';
    canvas.width = width;
    canvas.height = height;
    //document.body.appendChild( canvas );

    // change body bg color
    const changeBgColor = () => {
        const hue = Math.floor(Math.random() * 360);
        document.body.style.backgroundColor = "#fff";
    };



    // create confetti particles
    const createParticles = () => {
        particles = [];
        let total = 50;

        for (let i = 0; i < total; ++i) {
            particles.push(new ConfettiParticle(context, width, height));
        }
    };

    // animation loop function
    const animationFunc = () => {
        requestAnimationFrame(animationFunc);
        if (Math.random() > 0.98) changeBgColor();
        context.clearRect(0, 0, width, height);

        for (let p of particles) {
            p.width = width;
            p.height = height;
            p.update();
            p.draw();
        }
    };

    // on resize
    window.addEventListener('resize', e => {
        createParticles();
    });

    // start
    createParticles();
    changeBgColor();
    animationFunc();


})();

